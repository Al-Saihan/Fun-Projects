<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To-Do List</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet" />
</head>

<body class="background bg4">
  <header>
    <div id="nav-placeholder"></div>
  </header>

  <main>
    <h1>To-Do List</h1>
    <div class="todo-section">
      <form id="todo-form">
        <input type="text" id="todo-input" placeholder="Add a new task..." required />
        <button type="submit">Add</button>
      </form>
    </div>

    <div id="todo-lists" class="todo-section" style="max-width: 95%;">
      <h2 style="text-align: center;">Saved Tasks</h2>
      <ul id="saved-todo-list"></ul>
    </div>
  </main>

  <script src="/script.js"></script>
  <script>
    const STORAGE_KEY = 'alupotol';

    const todoForm = document.getElementById('todo-form');
    const todoInput = document.getElementById('todo-input');
    const savedTodoList = document.getElementById('saved-todo-list');

    var tasks = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    function render() {
      savedTodoList.innerHTML = '';
      if (tasks.length === 0) {
        var liEmpty = document.createElement('li');
        liEmpty.textContent = 'No saved tasks yet!';
        savedTodoList.appendChild(liEmpty);
      } else {
        for (var i = 0; i < tasks.length; i++) {
          var task = tasks[i];

          var li = document.createElement('li');
          if (task.completed) {
            li.className = 'task-item completed';
          } else {
            li.className = 'task-item';
          }

          var span = document.createElement('span');
          span.textContent = task.text;
          li.appendChild(span);

          var btns = document.createElement('div');
          btns.className = 'task-buttons';

          var toggleBtn = document.createElement('button');
          if (task.completed) {
            toggleBtn.textContent = 'Undo';
          } else {
            toggleBtn.textContent = 'Complete';
          }
          (function (t) {
            toggleBtn.addEventListener('click', function () {
              if (t.completed) {
                t.completed = false;
              } else {
                t.completed = true;
              }
              save();
              render();
            });
          })(task);
          btns.appendChild(toggleBtn);

          var delBtn = document.createElement('button');
          delBtn.textContent = 'Delete';
          delBtn.style.marginLeft = '5px';
          (function (taskId) {
            delBtn.addEventListener('click', function () {
              var newTasks = [];
              for (var j = 0; j < tasks.length; j++) {
                if (tasks[j].id === taskId) {
                  // skip this one (delete)
                } else {
                  newTasks.push(tasks[j]);
                }
              }
              tasks = newTasks;
              save();
              render();
            });
          })(task.id);
          btns.appendChild(delBtn);

          li.appendChild(btns);
          savedTodoList.appendChild(li);
        }
      }
    }

    todoForm.addEventListener('submit', function (e) {
      e.preventDefault();
      var text = todoInput.value.trim();
      if (text === '') {
        // do nothing
      } else {
        var newTask = { id: Date.now(), text: text, completed: false };
        tasks.push(newTask);
        todoInput.value = '';
        save();
        render();
      }
    });

    render();

  </script>
</body>

</html>